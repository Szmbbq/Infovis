<!DOCTYPE html>
<html>
<head>
	<title>Infomation Visualization Final Project</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
	Select dataset <select id="dataset">
		<option value = 1>Actor in a Leading Role</option>
		<option value = 0>Actress in a Leading Role</option>
	</select>
	Winners <select id="winner">
		<option value = 1>Show</option>
		<option value = 0>Hide</option>
	</select>
	High Scores <select id="highScores">
		<option value = 1>Show</option>
		<option value = 0>Hide</option>
	</select>
	Low Scores <select id="lowScores">
		<option value = 1>Show</option>
		<option value = 0>Hide</option>
	</select>
	Other Movies <select id="others">
		<option value = 1>Show</option>
		<option value = 0>Hide</option>
	</select>
	</select>
	High-Mean Difference <select id="HMDiff">
		<option value = 0>Hide</option>
		<option value = 1>Show</option>
	</select>
	</select>
	Low-Mean Difference <select id="LMDiff">
		<option value = 0>Hide</option>
		<option value = 1>Show</option>
	</select>
	Trend Group <select id="trendGroup">
		<option value = "none">Hide</option>
		<option value = "block">Show</option>
	</select>
	<button id="updateBtn" onclick="update()">Update Display</button>
	<script type="text/javascript" src="func/firstDesign.js"></script>
	<script type="text/javascript">
		// setup width and height of the svg canvas
		var width = 1000;
		var height = 300;

		// flags for control buttons
		var scaleSwitch = 0;

		// stats
		var years, minScore, differenceData, maxWinMeanDiff, maxLowMeanDiff;

		// scalers
		var xscale, pyscale, nyscale, yscale;

		// axes
		var xaxis, pyaxis, nyaxis, yaxis;

		// are axes already append to the svg (initial as false)
		var axesExist = false;

		// process the data
		const leading_actor_dataset = [];
		const leading_actress_dataset = [];
		const supporting_actor_dataset = [];
		const supporting_actress_dataset = [];
		var leading_actor = [];
		const leading_actress = [];
		const supporting_actor = [];
		const supporting_actress = [];

		// create a svg tag
		var svg = d3.select("body")
					.append("svg")
					.attr("width", width)
					.attr("height", 2 * height);

		var shit = "shit";
	</script>
<!-- 	<button id="upperBtn" onclick="hideHighMean()">Show movies whose score are lower than the mean</button>
	<button id="lowerBtn" onclick="hideLowMean()">Show movies whose score are higher than the mean</button> -->
	<button id="rescaleBtn" onclick="rescale()">Rescale</button>
	<button id="trendGroup" onclick="trendGroup()">Show/Hide Trend Group</button>
	<script type="text/javascript">
		
		d3.csv("./data/result1.csv", function(data) {
			data.forEach(function(d) {
				if(d['award'] == 'Actor' || d['award'] == 'Actor in a Leading Role') {
					// if that year already in dataset
					if(leading_actor_dataset[d['year']]) {
						// is this movie a winning movie?
						if(d['winner'] == '1') {
							leading_actor_dataset[d['year']]['winScore'] = parseFloat(d['vote_average']);
						}
						if(d['vote_average'] < leading_actor_dataset[d['year']]['lowScore']) {
							if(d['year'] == '1987') { console.log("1"); }
							var temp = leading_actor_dataset[d['year']]['lowScore'];
							leading_actor_dataset[d['year']]['lowScore'] = parseFloat(d['vote_average']);
							leading_actor_dataset[d['year']]['others'].push([temp]);
						} else if(d['vote_average'] > leading_actor_dataset[d['year']]['highScore']) {
							var temp = leading_actor_dataset[d['year']]['highScore'];
							leading_actor_dataset[d['year']]['highScore'] = parseFloat(d['vote_average']);
							// if nbOfMovies is 1 just modify the highScore, no need to push
							if(leading_actor_dataset[d['year']]['nbOfMovies'] > 1) {
								leading_actor_dataset[d['year']]['others'].push([temp]);
							}
						} else {
							leading_actor_dataset[d['year']]['others'].push([parseFloat(d['vote_average']), 0]);
						}
						// update the totalScore
						leading_actor_dataset[d['year']]['totalScore'] += parseFloat(d['vote_average']);
						// update the number of movies
						leading_actor_dataset[d['year']]['nbOfMovies'] += 1;
						// update the mean
						leading_actor_dataset[d['year']]['mean'] = leading_actor_dataset[d['year']]['totalScore']/leading_actor_dataset[d['year']]['nbOfMovies'];
						// update the difference
						leading_actor_dataset[d['year']]['others'].forEach(function(ele) {
							ele[1] = ele[0] - leading_actor_dataset[d['year']]['mean'];
						});
					} else {
						leading_actor_dataset[d['year']] = {};
						// add the year field
						leading_actor_dataset[d['year']]['year'] = d['year'];
						// initialize field totalScore, nbOfMovies, and others
						leading_actor_dataset[d['year']]['totalScore'] = 0;
						leading_actor_dataset[d['year']]['nbOfMovies'] = 0;
						leading_actor_dataset[d['year']]['others'] = [];
						// is this movie a winning movie?
						if(d['winner'] == '1') {
							leading_actor_dataset[d['year']]['winScore'] = parseFloat(d['vote_average']);
						} 
						// set the current lowScore
						leading_actor_dataset[d['year']]['lowScore'] = parseFloat(d['vote_average']);
						// set the current highScore
						leading_actor_dataset[d['year']]['highScore'] = parseFloat(d['vote_average']);
						// update the totalScore
						leading_actor_dataset[d['year']]['totalScore'] += parseFloat(d['vote_average']);
						// update number of movies
						leading_actor_dataset[d['year']]['nbOfMovies'] += 1;
						// update the mean
						leading_actor_dataset[d['year']]['mean'] = leading_actor_dataset[d['year']]['totalScore']/leading_actor_dataset[d['year']]['nbOfMovies'];
					}
				}
			});
			leading_actor_dataset.forEach(function(d) {
				leading_actor.push(d);
			});
			leading_actor = leading_actor.slice(31);

			// ------------ data processing finished -----------
			

			// draw the first design, target dataset as param
			firstDesign(leading_actor);
			trendGroup();
			update();
		});



	</script>
</body>
</html>